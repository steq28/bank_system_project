<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="stile.css" />
    <title>Transazione</title>
  </head>
  <body class="area">
    <div
      class="container w-50 p-3 position-absolute top-50 start-50 translate-middle d-grid gap-4"
    >
      <h1 class="text-center my-3 text-primary">
        <strong>NUOVA TRANSAZIONE</strong>
      </h1>
      <form class="d-grid gap-4" id="form">
        <div class="form-floating mb-3">
          <input
            type="text"
            class="form-control shadow-none"
            id="from"
            name="from"
            placeholder="ID mittente..."
            required
          />
          <label for="floatingInput">Mittente</label>
        </div>

        <div class="form-floating mb-3">
          <input
            type="text"
            class="form-control shadow-none"
            id="to"
            name="to"
            placeholder="ID beneficiario..."
            required
          />
          <label for="floatingInput">Beneficiario</label>
        </div>

        <div class="input-group mb-3">
          <span class="input-group-text">â‚¬</span>
          <input
            type="text"
            class="form-control shadow-none"
            name="amount"
            id="amount"
            placeholder="Inserisci l'ammontare da trasferire..."
            required
          />
        </div>
      </form>
      <div class="col text-center">
        <button onClick="checkData()" class="btn btn-primary btn-lg">
          Effettua transazione
        </button>
      </div>
    </div>
    <ul class="circles">
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>

    <script
      src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"
      type="text/javascript"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
    <script>
      function checkData() {
        let mittente = $("#from");
        let beneficiario = $("#to");
        let amount = $("#amount");
        let err = false;

        const regex = new RegExp(
          /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i
        );

        $("input[type=text]").each(function (index) {
          if (index != 2) {
            if (regex.test($(this).val())) {
              $(this).addClass("is-valid");
            } else {
              $(this).addClass("is-invalid");
              err = true;
            }
          } else {
            if ($(this).val() > 0) {
              $(this).addClass("is-valid");
            } else {
              $(this).addClass("is-invalid");
              err = true;
            }
          }
        });

        if (!err) {
          $.post("/api/transfer", $("#form").serialize()).done(function (data) {
            console.log(data);
            /*if (data == "OK") {
              $("#form")[0].reset();
            } else {
              alert(
                "Attenzione! Richiesta di inserimento fallita...controlla i dati"
              );
            }*/
            console.log(data);
          });

          alert(
            "Sono stati inviati correttamente " +
              $("#amount").val() +
              " euro da " +
              $("#from").val() +
              " a " +
              $("#to").val()
          );
        }
      }

      $("input").on("input", function () {
        $(this).removeClass("is-invalid");
        $(this).removeClass("is-valid");
      });
    </script>
  </body>
</html>
